<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Git Reflog - yangand</title><meta name=description content="TL;DR: to restore git history
 git reflog master git reset --hard @{1}  git reflog git все изменения в refs (ссылках) пишет в логи .git/logs/
Например, изменения в HEAD (или .git/HEAD) пишутся в .git/logs/HEAD
Обычно git reflog показывает только историю HEAD
4939906 HEAD@{0}: checkout: moving from test to master 494e06a HEAD@{1}: checkout: moving from master to test 4939906 HEAD@{2}: checkout: moving from 379e743595f56cb0b4177fd248c84c47523a4e6b to master 379e743 HEAD@{3}: checkout: moving from master to 379e743595f56cb0b4177fd248c84c47523a4e6b 4939906 HEAD@{4}: clone: from https://github."><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"yangand","url":"https:\/\/waffleboot.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/waffleboot.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/waffleboot.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/waffleboot.github.io\/posts\/16-git-reflog\/","name":"Git reflog"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":""},"headline":"Git Reflog","description":"TL;DR: to restore git history\n git reflog master git reset --hard @{1}  git reflog git все изменения в refs (ссылках) пишет в логи .git\/logs\/\nНапример, изменения в HEAD (или .git\/HEAD) пишутся в .git\/logs\/HEAD\nОбычно git reflog показывает только историю HEAD\n4939906 HEAD@{0}: checkout: moving from test to master 494e06a HEAD@{1}: checkout: moving from master to test 4939906 HEAD@{2}: checkout: moving from 379e743595f56cb0b4177fd248c84c47523a4e6b to master 379e743 HEAD@{3}: checkout: moving from master to 379e743595f56cb0b4177fd248c84c47523a4e6b 4939906 HEAD@{4}: clone: from https:\/\/github.","inLanguage":"en","wordCount":629,"datePublished":"2021-08-20T01:05:06","dateModified":"2021-08-20T01:05:06","image":"https:\/\/waffleboot.github.io\/","keywords":[""],"mainEntityOfPage":"https:\/\/waffleboot.github.io\/posts\/16-git-reflog\/","publisher":{"@type":"Organization","name":"https:\/\/waffleboot.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/waffleboot.github.io\/","height":60,"width":60}}}</script><meta property="og:title" content="Git Reflog"><meta property="og:description" content="TL;DR: to restore git history
 git reflog master git reset --hard @{1}  git reflog git все изменения в refs (ссылках) пишет в логи .git/logs/
Например, изменения в HEAD (или .git/HEAD) пишутся в .git/logs/HEAD
Обычно git reflog показывает только историю HEAD
4939906 HEAD@{0}: checkout: moving from test to master 494e06a HEAD@{1}: checkout: moving from master to test 4939906 HEAD@{2}: checkout: moving from 379e743595f56cb0b4177fd248c84c47523a4e6b to master 379e743 HEAD@{3}: checkout: moving from master to 379e743595f56cb0b4177fd248c84c47523a4e6b 4939906 HEAD@{4}: clone: from https://github."><meta property="og:url" content="https://waffleboot.github.io/posts/16-git-reflog/"><meta property="og:type" content="website"><meta property="og:site_name" content="yangand"><meta name=twitter:title content="Git Reflog"><meta name=twitter:description content="TL;DR: to restore git history
 git reflog master git reset --hard @{1}  git reflog git все изменения в refs (ссылках) пишет в логи .git/logs/
Например, изменения в HEAD (или .git/HEAD) пишутся в …"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.97.3"><link rel=alternate href=https://waffleboot.github.io/index.xml type=application/rss+xml title=yangand><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://waffleboot.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://waffleboot.github.io/css/syntax.css><link rel=stylesheet href=https://waffleboot.github.io/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://waffleboot.github.io/>yangand</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=posts-heading><h1>Git Reflog</h1><hr class=small></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>TL;DR: to restore git history</p><ul><li><code>git reflog master</code></li><li><code>git reset --hard @{1}</code></li></ul><h1 id=git-reflog>git reflog</h1><p>git все изменения в refs (ссылках) пишет в логи <code>.git/logs/</code><br>Например, изменения в HEAD (или .git/HEAD) пишутся в <code>.git/logs/HEAD</code><br>Обычно <code>git reflog</code> показывает только историю HEAD</p><pre tabindex=0><code>4939906 HEAD@{0}: checkout: moving from test to master
494e06a HEAD@{1}: checkout: moving from master to test
4939906 HEAD@{2}: checkout: moving from 379e743595f56cb0b4177fd248c84c47523a4e6b to master
379e743 HEAD@{3}: checkout: moving from master to 379e743595f56cb0b4177fd248c84c47523a4e6b
4939906 HEAD@{4}: clone: from https://github.com/waffleboot/git_rotten_dump.git
</code></pre><p>Это я сделал <code>git clone</code>, потом <code>git co 379e743</code> и в ветку test туда и обратно. git reflog показывает историю HEAD и можно откатиться на предыдущее состояние с помощью <code>git reset --hard HEAD@{x}</code>, тут HEAD@{x} показывает на нужный коммит, но можно и прямо sha указать. Вообще HEAD@{x} не имеет отношения к reflog, а просто способ указать ревизию, коммит. HEAD@{x} можно использовать везде.</p><p>Но git reflog может показать не только историю HEAD, а вообще историю веток. Только будет это <code>git reflog master</code>.</p><pre tabindex=0><code>4939906 master@{0}: clone: from https://github.com/waffleboot/git_rotten_dump.git
</code></pre><p>Чтобы вернуться к состоянию после rebase можно использовать</p><pre tabindex=0><code>git reflog master
git reset --hard master@{1}
</code></pre><p>git reflog покажет всю активность в HEAD, а в reflog master отложится только самое последнее стабилизирующее действие, потому что чтобы сделать rebase git сохранит HEAD в ORIG_HEAD, дальше начнет лить коммиты, при этом HEAD конечно же меняется, а значит вся эта история попадает в reglog HEAD, а вот в конце git перезаписывает master ref и уже там отложится финальная история, поэтому master@{1} позволяет искать предыдущее состояние по более короткой истории.</p><h3 id=какие-есть-способы-указать-git-revisionshttpsgit-scmcomdocsgitrevisions><a href=https://git-scm.com/docs/gitrevisions>Какие есть способы указать git revisions</a></h3><h4 id=refname-eg-master-headsmaster-refsheadsmaster>&lt;refname>, e.g. master, heads/master, refs/heads/master</h4><p>A symbolic ref name. E.g. <strong>master</strong> typically means the commit object referenced by <strong>refs/heads/master</strong>. If you happen to have both <strong>heads/master</strong> and <strong>tags/master</strong>, you can explicitly say <strong>heads/master</strong> to tell Git which one you mean. When ambiguous, a <strong>&lt;refname></strong> is disambiguated by taking the first match in the following rules:</p><ol><li><p>If <strong>.git/&lt;refname></strong> exists, that is what you mean (only for <code>HEAD</code>, <code>FETCH_HEAD</code>, <code>ORIG_HEAD</code>, <code>MERGE_HEAD</code> and <code>CHERRY_PICK_HEAD</code>);</p></li><li><p><strong>refs/&lt;refname></strong></p></li><li><p><strong>refs/tags/&lt;refname></strong></p></li><li><p><strong>refs/heads/&lt;refname></strong></p></li><li><p><strong>refs/remotes/&lt;refname></strong></p></li><li><p><strong>refs/remotes/&lt;refname>/HEAD</strong></p></li></ol><ul><li><code>HEAD</code> names the commit on which you based the changes in the working tree.</li><li><code>FETCH_HEAD</code> records the branch which you fetched from a remote repository with your last <code>git fetch</code> invocation.</li><li><code>ORIG_HEAD</code> is created by commands that move your <code>HEAD</code> in a drastic way, to record the position of the <code>HEAD</code> before their operation, so that you can easily change the tip of the branch back to the state before you ran them.</li><li><code>MERGE_HEAD</code> records the commit(s) which you are merging into your branch when you run <code>git merge</code>.</li><li><code>CHERRY_PICK_HEAD</code> records the commit which you are cherry-picking when you run <code>git cherry-pick</code>.</li></ul><p>Note that any of the <strong>refs/</strong>* cases above may come either from the <strong>.git/refs</strong> directory or from the <strong>.git/packed-refs</strong> file.</p><h4 id=heading>@</h4><p><strong>@</strong> alone is a shortcut for <code>HEAD</code></p><h4 id=refnamen-eg-master1>&lt;refname>@{&lt;n>}, e.g. master@{1}</h4><p>A ref followed by the suffix <strong>@</strong> with an ordinal specification enclosed in a brace pair (e.g. <strong>{1}, {15}</strong>) specifies the n-th prior value of that ref. For example <strong>master@{1}</strong> is the immediate prior value of master while <strong>master@{5}</strong> is the 5th prior value of master. This suffix may only be used immediately following a ref name and the ref must have an existing log (<strong>.git/logs/&lt;refname></strong>).</p><h4 id=n-eg-1>@{&lt;n>}, e.g. @{1}</h4><p>You can use the <strong>@</strong> construct with an empty ref part to get at a reflog entry of the current branch. For example, if you are on branch <strong>blabla</strong> then <strong>@{1}</strong> means the same as <strong>blabla@{1}</strong>.</p><h4 id=-n-eg--1>@{-&lt;n>}, e.g. @{-1}</h4><p>The construct <strong>@{-&lt;n>}</strong> means the th branch/commit checked out before the current one.</p><p>Т.е. можно исправить ошибочный rebase командой</p><pre tabindex=0><code>git reset --hard @{1}
</code></pre><h2 id=способы-указания-ref>способы указания ref</h2><pre tabindex=0><code>! git reflog
! git reflog yangand
  git reflog heads/yangand
  git reflog tags/yangand (смотреть перемещение тэга)
  git reflog refs/heads/yangand
  git reflog refs/remotes/origin/HEAD
  git reflog refs/remotes/origin/yangand
  git reflog remotes/origin/yangand
! git reflog origin/yangand
</code></pre></article><ul class="pager blog-pager"><li class=previous><a href=https://waffleboot.github.io/posts/15-git-reflog/ data-toggle=tooltip data-placement=top title="git reflog">&larr; Previous Post</a></li><li class=next><a href=https://waffleboot.github.io/posts/17-inet-lookup/ data-toggle=tooltip data-placement=top title="Как tcp находит свой сокет">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2022
&nbsp;&bull;&nbsp;
<a href=https://waffleboot.github.io/>yangand</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.97.3</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://waffleboot.github.io/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://waffleboot.github.io/js/load-photoswipe.js></script></body></html>